{% extends "base.html" %}

{% block title %}Register{% endblock %}

{% block body %}
  <div class="container">
    <h1>Register</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, msg in messages %}
          <div class="flash {{ category }}">{{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST" action="{{ url_for('register') }}">
      <label>Username:</label>
      <input type="text" name="username" required />

      <label>Password:</label>
      <input type="password" name="password" required />

      <label>Address:</label>
      <input type="text" name="address" required />

      <label>City:</label>
      <select id="cityDropdown" name="cityKey" required>
        <option value="">Select your city</option>
      </select>

      <label>Phone number:</label>
      <input type="text" name="phonenum" required />

      <button type="submit">Create account</button>
    </form>

    <p style="margin-top: 1rem;">
      Already have an account?
      <a href="{{ url_for('login') }}">Back to login</a>
    </p>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const cityDropdown = document.getElementById("cityDropdown");
    if (!cityDropdown) return;

    fetch("/cities")
      .then(res => res.json())
      .then(data => {
        cityDropdown.innerHTML = `<option value="">Select your city</option>`;

        (data.cities || []).forEach(city => {
          const option = document.createElement("option");
          option.value = city.cityKey;
          option.textContent = city.cityName;
          cityDropdown.appendChild(option);
        });
      })
      .catch(err => {
        console.error("Error loading cities", err);
      });
  });
</script>
{% endblock %}
